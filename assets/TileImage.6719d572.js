import{E as t,T as e,a as i,e as r,b as n,l as o,c as s,d as a,f as l,L as u,g as h,h as c,i as p,j as f,k as g,t as d,m as _,n as y,o as v,p as m,q as T,C as x,r as E,s as C,u as w,v as F,w as P,x as O,y as S,z as R,A as j,B as b,D as M,F as I,G as z,H as X,I as A,J as Y,K as L,N as G,O as D,P as Z,Q as W,R as k,S as U,U as K,W as q,X as N,Y as Q,Z as H,_ as J,$ as B,a0 as V,a1 as $,a2 as tt,a3 as et,a4 as it,a5 as rt,a6 as nt}from"./ol.bbcea228.js";var ot,st=(ot=function(t,e){return(ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}ot(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),at=function(n){function o(t,e,i){var r=n.call(this)||this,o=i||{};return r.tileCoord=t,r.state=e,r.interimTile=null,r.key="",r.transition_=void 0===o.transition?250:o.transition,r.transitionStarts_={},r}return st(o,n),o.prototype.changed=function(){this.dispatchEvent(t.CHANGE)},o.prototype.release=function(){},o.prototype.getKey=function(){return this.key+"/"+this.tileCoord},o.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==e.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},o.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,i=this;do{if(t.getState()==e.LOADED){t.interimTile=null;break}t.getState()==e.LOADING?i=t:t.getState()==e.IDLE?i.interimTile=t.interimTile:i=t,t=i.interimTile}while(t)}},o.prototype.getTileCoord=function(){return this.tileCoord},o.prototype.getState=function(){return this.state},o.prototype.setState=function(t){if(this.state!==e.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},o.prototype.load=function(){i()},o.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;var n=e-i+1e3/60;return n>=this.transition_?1:r(n/this.transition_)},o.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},o.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},o}(n),lt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();var ut=function(t){function i(e,i,r,n,o,s){var a=t.call(this,e,i,s)||this;return a.crossOrigin_=n,a.src_=r,a.key=r,a.image_=new Image,null!==n&&(a.image_.crossOrigin=n),a.unlisten_=null,a.tileLoadFunction_=o,a}return lt(i,t),i.prototype.getImage=function(){return this.image_},i.prototype.setImage=function(t){this.image_=t,this.state=e.LOADED,this.unlistenImage_(),this.changed()},i.prototype.handleImageError_=function(){var t;this.state=e.ERROR,this.unlistenImage_(),this.image_=((t=s(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()},i.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=e.LOADED:this.state=e.EMPTY,this.unlistenImage_(),this.changed()},i.prototype.load=function(){this.state==e.ERROR&&(this.state=e.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==e.IDLE&&(this.state=e.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=o(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},i.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},i}(at),ht=function(){function t(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var i=this.entries_[t];return a(void 0!==i,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_},t.prototype.remove=function(t){var e=this.entries_[t];return a(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){a(!(t in this.entries_),16);var i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}();function ct(t,e,i,r){return void 0!==r?(r[0]=t,r[1]=e,r[2]=i,r):[t,e,i]}function pt(t,e,i){return t+"/"+e+"/"+i}function ft(t){return pt(t[0],t[1],t[2])}var gt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return gt(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=function(t){return t.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(ft(e.tileCoord)),e.release())}.bind(this))}},e}(ht),_t=function(){function t(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function yt(t,e,i,r,n){return void 0!==n?(n.minX=t,n.maxX=e,n.minY=i,n.maxY=r,n):new _t(t,e,i,r)}var vt=_t,mt="preload",Tt="useInterimTilesOnError",xt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Et=function(t){function e(e){var i=this,r=e||{},n=l({},r);return delete n.preload,delete n.useInterimTilesOnError,(i=t.call(this,n)||this).on,i.once,i.un,i.setPreload(void 0!==r.preload?r.preload:0),i.setUseInterimTilesOnError(void 0===r.useInterimTilesOnError||r.useInterimTilesOnError),i}return xt(e,t),e.prototype.getPreload=function(){return this.get(mt)},e.prototype.setPreload=function(t){this.set(mt,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(Tt)},e.prototype.setUseInterimTilesOnError=function(t){this.set(Tt,t)},e}(u),Ct=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),wt=function(t){function i(e){var i=t.call(this,e)||this;return i.extentChanged=!0,i.renderedExtent_=null,i.renderedPixelRatio,i.renderedProjection=null,i.renderedRevision,i.renderedTiles=[],i.newTiles_=!1,i.tmpExtent=h(),i.tmpTileRange_=new vt(0,0,0,0),i}return Ct(i,t),i.prototype.isDrawableTile=function(t){var i=this.getLayer(),r=t.getState(),n=i.getUseInterimTilesOnError();return r==e.LOADED||r==e.EMPTY||r==e.ERROR&&!n},i.prototype.getTile=function(t,i,r,n){var o=n.pixelRatio,s=n.viewState.projection,a=this.getLayer(),l=a.getSource().getTile(t,i,r,o,s);return l.getState()==e.ERROR&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):l.setState(e.LOADED)),this.isDrawableTile(l)||(l=l.getInterimTile()),l},i.prototype.loadedTileCallback=function(e,i,r){return!!this.isDrawableTile(r)&&t.prototype.loadedTileCallback.call(this,e,i,r)},i.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},i.prototype.renderFrame=function(t,i){var r=t.layerStatesArray[t.layerIndex],n=t.viewState,o=n.projection,s=n.resolution,a=n.center,u=n.rotation,h=t.pixelRatio,x=this.getLayer(),E=x.getSource(),C=E.getRevision(),w=E.getTileGridForProjection(o),F=w.getZForResolution(s,E.zDirection),P=w.getResolution(F),O=t.extent,S=r.extent&&c(r.extent);S&&(O=p(O,c(r.extent)));var R=E.getTilePixelRatio(h),j=Math.round(t.size[0]*R),b=Math.round(t.size[1]*R);if(u){var M=Math.round(Math.sqrt(j*j+b*b));j=M,b=M}var I=P*j/2/R,z=P*b/2/R,X=[a[0]-I,a[1]-z,a[0]+I,a[1]+z],A=w.getTileRangeForExtentAndZ(O,F),Y={};Y[F]={};var L=this.createLoadedTileFinder(E,o,Y),G=this.tmpExtent,D=this.tmpTileRange_;this.newTiles_=!1;for(var Z=A.minX;Z<=A.maxX;++Z)for(var W=A.minY;W<=A.maxY;++W){var k=this.getTile(F,Z,W,t);if(this.isDrawableTile(k)){var U=f(this);if(k.getState()==e.LOADED){Y[F][k.tileCoord.toString()]=k;var K=k.inTransition(U);this.newTiles_||!K&&-1!==this.renderedTiles.indexOf(k)||(this.newTiles_=!0)}if(1===k.getAlpha(U,t.time))continue}var q=w.getTileCoordChildTileRange(k.tileCoord,D,G),N=!1;q&&(N=L(F+1,q)),N||w.forEachTileCoordParentTileRange(k.tileCoord,L,D,G)}var Q=P/s;g(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/R,1/R,u,-j/2,-b/2);var H=d(this.pixelTransform);this.useContainer(i,H,r.opacity);var J=this.context,B=J.canvas;_(this.inversePixelTransform,this.pixelTransform),g(this.tempTransform,j/2,b/2,Q,Q,0,-j/2,-b/2),B.width!=j||B.height!=b?(B.width=j,B.height=b):this.containerReused||J.clearRect(0,0,j,b),S&&this.clipUnrotated(J,t,S),l(J,E.getContextOptions()),this.preRender(J,t),this.renderedTiles.length=0;var V,$,tt,et=Object.keys(Y).map(Number);et.sort(y),1!==r.opacity||this.containerReused&&!E.getOpaque(t.viewState.projection)?(V=[],$=[]):et=et.reverse();for(var it=et.length-1;it>=0;--it){var rt=et[it],nt=E.getTilePixelSize(rt,h,o),ot=w.getResolution(rt)/P,st=nt[0]*ot*Q,at=nt[1]*ot*Q,lt=w.getTileCoordForCoordAndZ(v(X),rt),ut=w.getTileCoordExtent(lt),ht=m(this.tempTransform,[R*(ut[0]-X[0])/P,R*(X[3]-ut[3])/P]),ct=R*E.getGutterForProjection(o),pt=Y[rt];for(var ft in pt){var gt=(k=pt[ft]).tileCoord,dt=lt[1]-gt[1],_t=Math.round(ht[0]-(dt-1)*st),yt=lt[2]-gt[2],vt=Math.round(ht[1]-(yt-1)*at),mt=_t-(Z=Math.round(ht[0]-dt*st)),Tt=vt-(W=Math.round(ht[1]-yt*at)),xt=F===rt;if(!(K=xt&&1!==k.getAlpha(f(this),t.time)))if(V){J.save(),tt=[Z,W,Z+mt,W,Z+mt,W+Tt,Z,W+Tt];for(var Et=0,Ct=V.length;Et<Ct;++Et)if(F!==rt&&rt<$[Et]){var wt=V[Et];J.beginPath(),J.moveTo(tt[0],tt[1]),J.lineTo(tt[2],tt[3]),J.lineTo(tt[4],tt[5]),J.lineTo(tt[6],tt[7]),J.moveTo(wt[6],wt[7]),J.lineTo(wt[4],wt[5]),J.lineTo(wt[2],wt[3]),J.lineTo(wt[0],wt[1]),J.clip()}V.push(tt),$.push(rt)}else J.clearRect(Z,W,mt,Tt);this.drawTileImage(k,t,Z,W,mt,Tt,ct,xt,r.opacity),V&&!K?(J.restore(),this.renderedTiles.unshift(k)):this.renderedTiles.push(k),this.updateUsedTiles(t.usedTiles,E,k)}}return this.renderedRevision=C,this.renderedResolution=P,this.extentChanged=!this.renderedExtent_||!T(this.renderedExtent_,X),this.renderedExtent_=X,this.renderedPixelRatio=h,this.renderedProjection=o,this.manageTilePyramid(t,E,w,h,o,O,F,x.getPreload()),this.scheduleExpireCache(t,E),this.postRender(J,t),r.extent&&J.restore(),H!==B.style.transform&&(B.style.transform=H),this.container},i.prototype.drawTileImage=function(t,e,i,r,n,o,s,a,l){var u=this.getTileImage(t);if(u){var h=f(this),c=a?t.getAlpha(h,e.time):1,p=l*c,g=p!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(u,s,s,u.width-2*s,u.height-2*s,i,r,n,o),g&&this.context.restore(),1!==c?e.animate=!0:a&&t.endTransition(h)}},i.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},i.prototype.getTileImage=function(t){return t.getImage()},i.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=function(t,e,i){var r=f(t);r in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[r])}.bind(null,e);t.postRenderFunctions.push(i)}},i.prototype.updateUsedTiles=function(t,e,i){var r=f(e);r in t||(t[r]={}),t[r][i.getKey()]=!0},i.prototype.manageTilePyramid=function(t,i,r,n,o,s,a,l,u){var h=f(i);h in t.wantedTiles||(t.wantedTiles[h]={});var c,p,g,d,_,y,v=t.wantedTiles[h],m=t.tileQueue,T=0;for(y=r.getMinZoom();y<=a;++y)for(p=r.getTileRangeForExtentAndZ(s,y,p),g=r.getResolution(y),d=p.minX;d<=p.maxX;++d)for(_=p.minY;_<=p.maxY;++_)a-y<=l?(++T,(c=i.getTile(y,d,_,n,o)).getState()==e.IDLE&&(v[c.getKey()]=!0,m.isKeyQueued(c.getKey())||m.enqueue([c,h,r.getTileCoordCenter(c.tileCoord),g])),void 0!==u&&u(c)):i.useTile(y,d,_,o);i.updateCacheSize(T,o)},i}(x);wt.prototype.getLayer;var Ft,Pt=wt,Ot=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),St=function(t){function e(e){return t.call(this,e)||this}return Ot(e,t),e.prototype.createRenderer=function(){return new Pt(this)},e}(Et),Rt=function(){function t(t,e,i,r,n,o){this.sourceProj_=t,this.targetProj_=e;var s={},a=E(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return s[e]||(s[e]=a(t)),s[e]},this.maxSourceExtent_=r,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&C(r)==C(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?C(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?C(this.targetProj_.getExtent()):null;var l=v(i),u=w(i),h=F(i),c=P(i),p=this.transformInv_(l),f=this.transformInv_(u),g=this.transformInv_(h),d=this.transformInv_(c),_=10+(o?Math.max(0,Math.ceil(O(S(i)/(o*o*256*256)))):0);if(this.addQuad_(l,u,h,c,p,f,g,d,_),this.wrapsXInSource_){var y=1/0;this.triangles_.forEach((function(t,e,i){y=Math.min(y,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-y>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-y>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-y>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-y>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var i=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-i<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}s={}}return t.prototype.addTriangle_=function(t,e,i,r,n,o){this.triangles_.push({source:[r,n,o],target:[t,e,i]})},t.prototype.addQuad_=function(t,e,i,r,n,o,s,a,l){var u=R([n,o,s,a]),h=this.sourceWorldWidth_?C(u)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&h>.5&&h<1,f=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var g=R([t,e,i,r]);f=C(g)/this.targetWorldWidth_>.25||f}!p&&this.sourceProj_.isGlobal()&&h&&(f=h>.25||f)}if(!(!f&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3]))||j(u,this.maxSourceExtent_)){var d=0;if(!(f||isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1])))if(l>0)f=!0;else if(1!=(d=(isFinite(n[0])&&isFinite(n[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(s[0])&&isFinite(s[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1))&&2!=d&&4!=d&&8!=d)return;if(l>0){if(!f){var _=[(t[0]+i[0])/2,(t[1]+i[1])/2],y=this.transformInv_(_),v=void 0;if(p)v=(b(n[0],c)+b(s[0],c))/2-b(y[0],c);else v=(n[0]+s[0])/2-y[0];var m=(n[1]+s[1])/2-y[1];f=v*v+m*m>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var T=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(T),E=[(r[0]+t[0])/2,(r[1]+t[1])/2],w=this.transformInv_(E);this.addQuad_(t,e,T,E,n,o,x,w,l-1),this.addQuad_(E,T,i,r,w,x,s,a,l-1)}else{var F=[(t[0]+e[0])/2,(t[1]+e[1])/2],P=this.transformInv_(F),O=[(i[0]+r[0])/2,(i[1]+r[1])/2],S=this.transformInv_(O);this.addQuad_(t,F,O,r,n,P,S,a,l-1),this.addQuad_(F,e,i,O,P,o,s,S,l-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&d)&&this.addTriangle_(t,i,r,n,s,a),0==(14&d)&&this.addTriangle_(t,i,e,n,s,o),d&&(0==(13&d)&&this.addTriangle_(e,r,t,o,a,n),0==(7&d)&&this.addTriangle_(e,r,i,o,a,s))}},t.prototype.calculateSourceExtent=function(){var t=h();return this.triangles_.forEach((function(e,i,r){var n=e.source;M(t,n[0]),M(t,n[1]),M(t,n[2])})),t},t.prototype.getTriangles=function(){return this.triangles_},t}(),jt={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1};function bt(t,e,i,r,n){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(r,n),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,r)+1,Math.max(i,n)),t.restore()}function Mt(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function It(t,e,i,r){var n=L(i,e,t),o=G(e,r,i),s=e.getMetersPerUnit();void 0!==s&&(o*=s);var a=t.getMetersPerUnit();void 0!==a&&(o/=a);var l=t.getExtent();if(!l||D(l,n)){var u=G(t,o,n)/o;isFinite(u)&&u>0&&(o/=u)}return o}function zt(t,e,i,r,n,o,a,u,c,p,f,g){var d=s(Math.round(i*t),Math.round(i*e));if(l(d,g),0===c.length)return d.canvas;function _(t){return Math.round(t*i)/i}d.scale(i,i),d.globalCompositeOperation="lighter";var y=h();c.forEach((function(t,e,i){I(y,t.extent)}));var m=C(y),T=z(y),x=s(Math.round(i*m/r),Math.round(i*T/r));l(x,g);var E=i/r;c.forEach((function(t,e,i){var r=t.extent[0]-y[0],n=-(t.extent[3]-y[3]),o=C(t.extent),s=z(t.extent);t.image.width>0&&t.image.height>0&&x.drawImage(t.image,p,p,t.image.width-2*p,t.image.height-2*p,r*E,n*E,o*E,s*E)}));var w=v(a);return u.getTriangles().forEach((function(t,e,n){var s=t.source,a=t.target,l=s[0][0],u=s[0][1],h=s[1][0],c=s[1][1],p=s[2][0],f=s[2][1],v=_((a[0][0]-w[0])/o),m=_(-(a[0][1]-w[1])/o),T=_((a[1][0]-w[0])/o),E=_(-(a[1][1]-w[1])/o),C=_((a[2][0]-w[0])/o),F=_(-(a[2][1]-w[1])/o),P=l,O=u;l=0,u=0;var S=X([[h-=P,c-=O,0,0,T-v],[p-=P,f-=O,0,0,C-v],[0,0,h,c,E-m],[0,0,p,f,F-m]]);if(S){if(d.save(),d.beginPath(),function(){if(void 0===Ft){var t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",bt(t,4,5,4,0),bt(t,4,5,0,5);var e=t.getImageData(0,0,3,3).data;Ft=Mt(e,0)||Mt(e,4)||Mt(e,8)}return Ft}()||g===jt){d.moveTo(T,E);for(var R=v-T,j=m-E,b=0;b<4;b++)d.lineTo(T+_((b+1)*R/4),E+_(b*j/3)),3!=b&&d.lineTo(T+_((b+1)*R/4),E+_((b+1)*j/3));d.lineTo(C,F)}else d.moveTo(T,E),d.lineTo(v,m),d.lineTo(C,F);d.clip(),d.transform(S[0],S[2],S[1],S[3],v,m),d.translate(y[0]-P,y[3]-O),d.scale(r/i,-r/i),d.drawImage(x.canvas,0,0),d.restore()}})),f&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,u.getTriangles().forEach((function(t,e,i){var r=t.target,n=(r[0][0]-w[0])/o,s=-(r[0][1]-w[1])/o,a=(r[1][0]-w[0])/o,l=-(r[1][1]-w[1])/o,u=(r[2][0]-w[0])/o,h=-(r[2][1]-w[1])/o;d.beginPath(),d.moveTo(a,l),d.lineTo(n,s),d.lineTo(u,h),d.closePath(),d.stroke()})),d.restore()),d.canvas}var Xt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),At=function(i){function r(t,r,n,o,s,a,l,u,h,c,f,g){var d=i.call(this,s,e.IDLE)||this;d.renderEdges_=void 0!==f&&f,d.contextOptions_=g,d.pixelRatio_=l,d.gutter_=u,d.canvas_=null,d.sourceTileGrid_=r,d.targetTileGrid_=o,d.wrappedTileCoord_=a||s,d.sourceTiles_=[],d.sourcesListenerKeys_=null,d.sourceZ_=0;var _=o.getTileCoordExtent(d.wrappedTileCoord_),y=d.targetTileGrid_.getExtent(),v=d.sourceTileGrid_.getExtent(),m=y?p(_,y):_;if(0===S(m))return d.state=e.EMPTY,d;var T=t.getExtent();T&&(v=v?p(v,T):T);var x=o.getResolution(d.wrappedTileCoord_[0]),E=function(t,e,i,r){var n=A(i),o=It(t,e,n,r);return(!isFinite(o)||o<=0)&&Y(i,(function(i){return o=It(t,e,i,r),isFinite(o)&&o>0})),o}(t,n,m,x);if(!isFinite(E)||E<=0)return d.state=e.EMPTY,d;var C=void 0!==c?c:.5;if(d.triangulation_=new Rt(t,n,m,v,E*C,x),0===d.triangulation_.getTriangles().length)return d.state=e.EMPTY,d;d.sourceZ_=r.getZForResolution(E);var w=d.triangulation_.calculateSourceExtent();if(v&&(t.canWrapX()?(w[1]=k(w[1],v[1],v[3]),w[3]=k(w[3],v[1],v[3])):w=p(w,v)),S(w)){for(var F=r.getTileRangeForExtentAndZ(w,d.sourceZ_),P=F.minX;P<=F.maxX;P++)for(var O=F.minY;O<=F.maxY;O++){var R=h(d.sourceZ_,P,O,l);R&&d.sourceTiles_.push(R)}0===d.sourceTiles_.length&&(d.state=e.EMPTY)}else d.state=e.EMPTY;return d}return Xt(r,i),r.prototype.getImage=function(){return this.canvas_},r.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(i,r,n){i&&i.getState()==e.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(i.tileCoord),image:i.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=e.ERROR;else{var i=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(i),n="number"==typeof r?r:r[0],o="number"==typeof r?r:r[1],s=this.targetTileGrid_.getResolution(i),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=zt(n,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=e.LOADED}this.changed()},r.prototype.load=function(){if(this.state==e.IDLE){this.state=e.LOADING,this.changed();var i=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(r,n,o){var s=r.getState();if(s==e.IDLE||s==e.LOADING){i++;var a=Z(r,t.CHANGE,(function(t){var n=r.getState();n!=e.LOADED&&n!=e.ERROR&&n!=e.EMPTY||(W(a),0===--i&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(a)}}.bind(this)),0===i?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,i,r){t.getState()==e.IDLE&&t.load()}))}},r.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(W),this.sourcesListenerKeys_=null},r}(at),Yt="tileloadstart",Lt="tileloadend",Gt="tileloaderror",Dt=[0,0,0],Zt=function(){function t(t){var e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,a(U(this.resolutions_,(function(t,e){return e-t}),!0),17),!t.origins)for(var i=0,r=this.resolutions_.length-1;i<r;++i)if(e){if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}else e=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,a(this.origins_.length==this.resolutions_.length,20));var n=t.extent;void 0===n||this.origin_||this.origins_||(this.origin_=v(n)),a(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,a(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:K,a(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==n?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){var i=new vt(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(n){var r=this.getTileRangeForExtentAndZ(n,e);i.minX=Math.max(r.minX,i.minX),i.maxX=Math.min(r.maxX,i.maxX),i.minY=Math.max(r.minY,i.minY),i.maxY=Math.min(r.maxY,i.maxY)}return i}),this):n&&this.calculateTileRanges_(n)}return t.prototype.forEachTileCoord=function(t,e,i){for(var r=this.getTileRangeForExtentAndZ(t,e),n=r.minX,o=r.maxX;n<=o;++n)for(var s=r.minY,a=r.maxY;s<=a;++s)i([e,n,s])},t.prototype.forEachTileCoordParentTileRange=function(t,e,i,r){var n,o,s=null,a=t[0]-1;for(2===this.zoomFactor_?(n=t[1],o=t[2]):s=this.getTileCoordExtent(t,r);a>=this.minZoom;){if(e(a,2===this.zoomFactor_?yt(n=Math.floor(n/2),n,o=Math.floor(o/2),o,i):this.getTileRangeForExtentAndZ(s,a,i)))return!0;--a}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var r=2*t[1],n=2*t[2];return yt(r,r+1,n,n+1,e)}var o=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null},t.prototype.getTileRangeForTileCoordAndZ=function(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;var r=t[0],n=t[1],o=t[2];if(e===r)return yt(n,o,n,o,i);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,e-r),a=Math.floor(n*s),l=Math.floor(o*s);return e<r?yt(a,a,l,l,i):yt(a,Math.floor(s*(n+1))-1,l,Math.floor(s*(o+1))-1,i)}var u=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,e,i)},t.prototype.getTileRangeExtent=function(t,e,i){var r=this.getOrigin(t),n=this.getResolution(t),o=q(this.getTileSize(t),this.tmpSize_),s=r[0]+e.minX*o[0]*n,a=r[0]+(e.maxX+1)*o[0]*n,l=r[1]+e.minY*o[1]*n,u=r[1]+(e.maxY+1)*o[1]*n;return N(s,l,a,u,i)},t.prototype.getTileRangeForExtentAndZ=function(t,e,i){var r=Dt;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,r);var n=r[1],o=r[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,r),yt(n,r[1],o,r[2],i)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=q(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]},t.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=q(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*n[0]*r,s=i[1]-(t[2]+1)*n[1]*r,a=o+n[0]*r,l=s+n[1]*r;return N(o,s,a,l,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,i,r,n){var o=this.getZForResolution(i),s=i/this.getResolution(o),a=this.getOrigin(o),l=q(this.getTileSize(o),this.tmpSize_),u=r?.5:0,h=r?.5:0,c=Math.floor((t-a[0])/i+u),p=Math.floor((a[1]-e)/i+h),f=s*c/l[0],g=s*p/l[1];return r?(f=Math.ceil(f)-1,g=Math.ceil(g)-1):(f=Math.floor(f),g=Math.floor(g)),ct(o,f,g,n)},t.prototype.getTileCoordForXYAndZ_=function(t,e,i,r,n){var o=this.getOrigin(i),s=this.getResolution(i),a=q(this.getTileSize(i),this.tmpSize_),l=r?.5:0,u=r?.5:0,h=Math.floor((t-o[0])/s+l),c=Math.floor((o[1]-e)/s+u),p=h/a[0],f=c/a[1];return r?(p=Math.ceil(p)-1,f=Math.ceil(f)-1):(p=Math.floor(p),f=Math.floor(f)),ct(i,p,f,n)},t.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},t.prototype.getZForResolution=function(t,e){var i=Q(this.resolutions_,t,e||0);return k(i,this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i},t}();function Wt(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,i,r){return function(t,e,i,r){var n=void 0!==r?r:tt.TOP_LEFT,o=Ut(t,e,i);return new Zt({extent:t,origin:V(t,n),resolutions:o,tileSize:i})}(Kt(t),e,i,r)}(t),t.setDefaultTileGrid(e)),e}function kt(t){var e=t||{},i=e.extent||H("EPSG:3857").getExtent(),r={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Ut(i,e.maxZoom,e.tileSize,e.maxResolution)};return new Zt(r)}function Ut(t,e,i,r){for(var n=void 0!==e?e:$,o=z(t),s=C(t),a=q(void 0!==i?i:K),l=r>0?r:Math.max(s/a[0],o/a[1]),u=n+1,h=new Array(u),c=0;c<u;++c)h[c]=l/Math.pow(2,c);return h}function Kt(t){var e=(t=H(t)).getExtent();if(!e){var i=180*J[B.DEGREES]/t.getMetersPerUnit();e=N(-i,-i,i,i)}return e}var qt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Nt=function(t){function r(e){var i=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX})||this;i.on,i.once,i.un,i.opaque_=void 0!==e.opaque&&e.opaque,i.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,i.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;var r=e.tileGrid;return r&&q(r.getTileSize(r.getMinZoom()),[256,256]),i.tileCache=new dt(e.cacheSize||0),i.tmpSize=[0,0],i.key_=e.key||"",i.tileOptions={transition:e.transition},i.zDirection=e.zDirection?e.zDirection:0,i}return qt(r,t),r.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},r.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);i&&i.expireCache(e)},r.prototype.forEachLoadedTile=function(t,i,r,n){var o=this.getTileCacheForProjection(t);if(!o)return!1;for(var s,a,l,u=!0,h=r.minX;h<=r.maxX;++h)for(var c=r.minY;c<=r.maxY;++c)a=pt(i,h,c),l=!1,o.containsKey(a)&&(l=(s=o.get(a)).getState()===e.LOADED)&&(l=!1!==n(s)),l||(u=!1);return u},r.prototype.getGutterForProjection=function(t){return 0},r.prototype.getKey=function(){return this.key_},r.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},r.prototype.getOpaque=function(t){return this.opaque_},r.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},r.prototype.getTile=function(t,e,r,n,o){return i()},r.prototype.getTileGrid=function(){return this.tileGrid},r.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Wt(t)},r.prototype.getTileCacheForProjection=function(t){return a(et(this.getProjection(),t),68),this.tileCache},r.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},r.prototype.getTilePixelSize=function(t,e,i){var r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(e),o=q(r.getTileSize(t),this.tmpSize);return 1==n?o:it(o,n,this.tmpSize)},r.prototype.getTileCoordForTileUrlFunction=function(t,e){var i=void 0!==e?e:this.getProjection(),r=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=function(t,e,i){var r=e[0],n=t.getTileCoordCenter(e),o=Kt(i);if(D(o,n))return e;var s=C(o),a=Math.ceil((o[0]-n[0])/s);return n[0]+=s*a,t.getTileCoordForCoordAndZ(n,r)}(r,t,i)),function(t,e){var i=t[0],r=t[1],n=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;var o=e.getFullTileRange(i);return!o||o.containsXY(r,n)}(t,r)?t:null},r.prototype.clear=function(){this.tileCache.clear()},r.prototype.refresh=function(){this.clear(),t.prototype.refresh.call(this)},r.prototype.updateCacheSize=function(t,e){var i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)},r.prototype.useTile=function(t,e,i,r){},r}(rt),Qt=function(t){function e(e,i){var r=t.call(this,e)||this;return r.tile=i,r}return qt(e,t),e}(nt),Ht=Nt;function Jt(t,e){var i=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,o=/\{-y\}/g;return function(s,l,u){return s?t.replace(i,s[0].toString()).replace(r,s[1].toString()).replace(n,s[2].toString()).replace(o,(function(){var t=s[0],i=e.getFullTileRange(t);return a(i,55),(i.getHeight()-s[2]-1).toString()})):void 0}}function Bt(t,e){for(var i=t.length,r=new Array(i),n=0;n<i;++n)r[n]=Jt(t[n],e);return Vt(r)}function Vt(t){return 1===t.length?t[0]:function(e,i,r){if(e){var n=function(t){return(t[1]<<t[0])+t[2]}(e),o=b(n,t.length);return t[o](e,i,r)}}}var $t=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),te=function(t){function i(e){var r=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this;return r.generateTileUrlFunction_=r.tileUrlFunction===i.prototype.tileUrlFunction,r.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(r.tileUrlFunction=e.tileUrlFunction),r.urls=null,e.urls?r.setUrls(e.urls):e.url&&r.setUrl(e.url),r.tileLoadingKeys_={},r}return $t(i,t),i.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},i.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},i.prototype.getUrls=function(){return this.urls},i.prototype.handleTileChange=function(t){var i,r=t.target,n=f(r),o=r.getState();o==e.LOADING?(this.tileLoadingKeys_[n]=!0,i=Yt):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],i=o==e.ERROR?Gt:o==e.LOADED?Lt:void 0),null!=i&&this.dispatchEvent(new Qt(i,r))},i.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},i.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},i.prototype.setUrl=function(t){var e=function(t){var e=[],i=/\{([a-z])-([a-z])\}/.exec(t);if(i){var r=i[1].charCodeAt(0),n=i[2].charCodeAt(0),o=void 0;for(o=r;o<=n;++o)e.push(t.replace(i[0],String.fromCharCode(o)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t)){for(var s=parseInt(i[2],10),a=parseInt(i[1],10);a<=s;a++)e.push(t.replace(i[0],a.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)},i.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Bt(t,this.tileGrid),e):this.setKey(e)},i.prototype.tileUrlFunction=function(t,e,i){},i.prototype.useTile=function(t,e,i){var r=pt(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)},i}(Ht),ee=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();function ie(t,e){t.getImage().src=e}var re=function(i){function r(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ie,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,e.tileClass=void 0!==t.tileClass?t.tileClass:ut,e.tileCacheForProjection={},e.tileGridForProjection={},e.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,e.contextOptions_=!1===t.imageSmoothing?jt:void 0,e.renderReprojectionEdges_=!1,e}return ee(r,i),r.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},r.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);for(var r in this.tileCache.expireCache(this.tileCache==i?e:{}),this.tileCacheForProjection){var n=this.tileCacheForProjection[r];n.expireCache(n==i?e:{})}},r.prototype.getContextOptions=function(){return this.contextOptions_},r.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!et(this.getProjection(),t)?0:this.getGutter()},r.prototype.getGutter=function(){return 0},r.prototype.getKey=function(){return i.prototype.getKey.call(this)+(this.contextOptions_?"\n"+JSON.stringify(this.contextOptions_):"")},r.prototype.getOpaque=function(t){return!(this.getProjection()&&t&&!et(this.getProjection(),t))&&i.prototype.getOpaque.call(this,t)},r.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!et(e,t)){var i=f(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Wt(t)),this.tileGridForProjection[i]}return this.tileGrid},r.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||et(e,t))return this.tileCache;var i=f(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new dt(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]},r.prototype.createTile_=function(i,r,n,o,s,a){var l=[i,r,n],u=this.getTileCoordForTileUrlFunction(l,s),h=u?this.tileUrlFunction(u,o,s):void 0,c=new this.tileClass(l,void 0!==h?e.IDLE:e.EMPTY,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=a,c.addEventListener(t.CHANGE,this.handleTileChange.bind(this)),c},r.prototype.getTile=function(t,e,i,r,n){var o=this.getProjection();if(o&&n&&!et(o,n)){var s=this.getTileCacheForProjection(n),a=[t,e,i],l=void 0,u=ft(a);s.containsKey(u)&&(l=s.get(u));var h=this.getKey();if(l&&l.key==h)return l;var c=this.getTileGridForProjection(o),p=this.getTileGridForProjection(n),f=this.getTileCoordForTileUrlFunction(a,n),g=new At(o,c,n,p,a,f,this.getTilePixelRatio(r),this.getGutter(),function(t,e,i,r){return this.getTileInternal(t,e,i,r,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return g.key=h,l?(g.interimTile=l,g.refreshInterimChain(),s.replace(u,g)):s.set(u,g),g}return this.getTileInternal(t,e,i,r,o||n)},r.prototype.getTileInternal=function(t,i,r,n,o){var s=null,a=pt(t,i,r),l=this.getKey();if(this.tileCache.containsKey(a)){if((s=this.tileCache.get(a)).key!=l){var u=s;s=this.createTile_(t,i,r,n,o,l),u.getState()==e.IDLE?s.interimTile=u.interimTile:s.interimTile=u,s.refreshInterimChain(),this.tileCache.replace(a,s)}}else s=this.createTile_(t,i,r,n,o,l),this.tileCache.set(a,s);return s},r.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},r.prototype.setTileGridForProjection=function(t,e){var i=H(t);if(i){var r=f(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}},r}(te);export{St as T,re as a,Vt as b,kt as c,ct as d,Kt as e,Bt as f};
