import{p as e,b as t,A as r,d as n,H as i,C as o,f as a,J as s,L as u,g as h,F as l,h as g,u as d,o as _,t as c}from"./vendor.ec101613.js";import{T as p}from"./TileImage.6719d572.js";import{O as f}from"./OSM.b07225a9.js";import{h as v,L as m,S as y,V as x,a as E,f as C,b as F,d as w,c as P,e as S}from"./Vector.d80cd09d.js";import{a6 as T,ct as G,cu as M,cv as b,cn as L,aq as I,b1 as R,b3 as B,E as N,z as O,ce as A,bb as V,cp as D,cw as j,ck as U,j as k,cx as q,cr as K,bO as W,h as H,a$ as Y,aC as X,cl as z,aA as J,bF as Q,cy as Z,cz as $,ca as ee,cA as te,b6 as re,cj as ne,g as ie,P as oe,b5 as ae,Q as se,cB as ue,M as he,V as le}from"./ol.bbcea228.js";import{D as ge}from"./Draw.12b5e8b7.js";import"./XYZ.4ee3e030.js";import"./LineString.9ae0adb3.js";import"./MultiPolygon.1b740cf8.js";var de,_e=(de=function(e,t){return(de=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}de(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),ce=[0,0,0,0],pe=[],fe="modifystart",ve="modifyend",me=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.features=r,i.mapBrowserEvent=n,i}return _e(t,e),t}(T);function ye(e,t){return e.index-t.index}function xe(e,t,r){var n=t.geometry;if(n.getType()===I.CIRCLE){var i=n;if(1===t.index){var o=ee();o&&(i=i.clone().transform(o,r));var a=z(i.getCenter(),U(e)),s=Math.sqrt(a)-i.getRadius();return s*s}}var u=U(e);return pe[0]=U(t.segment[0]),pe[1]=U(t.segment[1]),te(u,pe)}function Ee(e,t,r){var n=t.geometry;if(n.getType()===I.CIRCLE&&1===t.index){var i=n,o=ee();return o&&(i=i.clone().transform(o,r)),Z(i.getClosestPoint(U(e)))}var a=U(e);return pe[0]=U(t.segment[0]),pe[1]=U(t.segment[1]),Z($(a,pe))}var Ce=function(e){function t(t){var r,n,i=e.call(this,t)||this;if(i.on,i.once,i.un,i.boundHandleFeatureChange_=i.handleFeatureChange_.bind(i),i.condition_=t.condition?t.condition:G,i.defaultDeleteCondition_=function(e){return M(e)&&b(e)},i.deleteCondition_=t.deleteCondition?t.deleteCondition:i.defaultDeleteCondition_,i.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:L,i.vertexFeature_=null,i.vertexSegments_=null,i.lastPixel_=[0,0],i.ignoreNextSingleClick_=!1,i.featuresBeingModified_=null,i.rBush_=new v,i.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,i.snappedToVertex_=!1,i.changingFeature_=!1,i.dragSegments_=[],i.overlay_=new m({source:new y({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(r=C(),function(e,t){return r[I.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),i.SEGMENT_WRITERS_={Point:i.writePointGeometry_.bind(i),LineString:i.writeLineStringGeometry_.bind(i),LinearRing:i.writeLineStringGeometry_.bind(i),Polygon:i.writePolygonGeometry_.bind(i),MultiPoint:i.writeMultiPointGeometry_.bind(i),MultiLineString:i.writeMultiLineStringGeometry_.bind(i),MultiPolygon:i.writeMultiPolygonGeometry_.bind(i),Circle:i.writeCircleGeometry_.bind(i),GeometryCollection:i.writeGeometryCollectionGeometry_.bind(i)},i.source_=null,i.hitDetection_=null,t.features?n=t.features:t.source&&(i.source_=t.source,n=new R(i.source_.getFeatures()),i.source_.addEventListener(x.ADDFEATURE,i.handleSourceAdd_.bind(i)),i.source_.addEventListener(x.REMOVEFEATURE,i.handleSourceRemove_.bind(i))),!n)throw new Error("The modify interaction requires features, a source or a layer");return t.hitDetection&&(i.hitDetection_=t.hitDetection),i.features_=n,i.features_.forEach(i.addFeature_.bind(i)),i.features_.addEventListener(B.ADD,i.handleFeatureAdd_.bind(i)),i.features_.addEventListener(B.REMOVE,i.handleFeatureRemove_.bind(i)),i.lastPointerEvent_=null,i.delta_=[0,0],i.snapToPointer_=void 0===t.snapToPointer?!i.hitDetection_:t.snapToPointer,i}return _e(t,e),t.prototype.addFeature_=function(e){var t=e.getGeometry();if(t){var r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}var n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(N.CHANGE,this.boundHandleFeatureChange_)},t.prototype.willModifyFeatures_=function(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new R;for(var r=this.featuresBeingModified_.getArray(),n=0,i=t.length;n<i;++n)for(var o=t[n],a=0,s=o.length;a<s;++a){var u=o[a].feature;u&&-1===r.indexOf(u)&&this.featuresBeingModified_.push(u)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new me(fe,this.featuresBeingModified_,e))}},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(N.CHANGE,this.boundHandleFeatureChange_)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach((function(t){e===t.feature&&r.push(t)}));for(var n=r.length-1;n>=0;--n){for(var i=r[n],o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===i&&this.dragSegments_.splice(o,1);t.remove(i)}},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),n={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(O(o),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var u=o.slice(a,a+2),h={feature:e,geometry:t,depth:[n],index:a,segment:u};this.rBush_.insert(O(u),h)}},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var u=o.slice(a,a+2),h={feature:e,geometry:t,depth:[n],index:a,segment:u};this.rBush_.insert(O(u),h)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var u=o[a],h=0,l=u.length-1;h<l;++h){var g=u.slice(h,h+2),d={feature:e,geometry:t,depth:[a,n],index:h,segment:g};this.rBush_.insert(O(g),d)}},t.prototype.writeCircleGeometry_=function(e,t){var r=t.getCenter(),n={feature:e,geometry:t,index:0,segment:[r,r]},i={feature:e,geometry:t,index:1,segment:[r,r]},o=[n,i];n.featureSegments=o,i.featureSegments=o,this.rBush_.insert(A(r),n);var a=t;this.rBush_.insert(a.getExtent(),i)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var i=r[n];(0,this.SEGMENT_WRITERS_[i.getType()])(e,i)}},t.prototype.createOrUpdateVertexFeature_=function(e,t,r){var n=this.vertexFeature_;n?n.getGeometry().setCoordinates(e):(n=new E(new V(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n));return n.set("features",t),n.set("geometries",r),n},t.prototype.handleEvent=function(t){return!t.originalEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=D.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(r=!(t.type!=D.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==D.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!r);var r},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);for(var t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],n=[],i=0,o=this.dragSegments_.length;i<o;++i){var a=this.dragSegments_[i],s=a[0],u=s.feature;-1===r.indexOf(u)&&r.push(u);var h=s.geometry;-1===n.indexOf(h)&&n.push(h);for(var l=s.depth,g=void 0,d=s.segment,_=a[1];t.length<h.getStride();)t.push(d[_][t.length]);switch(h.getType()){case I.POINT:g=t,d[0]=t,d[1]=t;break;case I.MULTI_POINT:(g=h.getCoordinates())[s.index]=t,d[0]=t,d[1]=t;break;case I.LINE_STRING:(g=h.getCoordinates())[s.index+_]=t,d[_]=t;break;case I.MULTI_LINE_STRING:case I.POLYGON:(g=h.getCoordinates())[l[0]][s.index+_]=t,d[_]=t;break;case I.MULTI_POLYGON:(g=h.getCoordinates())[l[1]][l[0]][s.index+_]=t,d[_]=t;break;case I.CIRCLE:if(d[0]=t,d[1]=t,0===s.index)this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;var c=e.map.getView().getProjection(),p=j(U(h.getCenter()),U(t)),f=ee();if(f){var v=h.clone().transform(f,c);v.setRadius(p),p=v.transform(c,f).getRadius()}h.setRadius(p),this.changingFeature_=!1}}g&&this.setGeometryCoordinates_(h,g)}this.createOrUpdateVertexFeature_(t,r,n)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;var t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;var r=this.vertexFeature_;if(r){var n=e.map.getView().getProjection(),i=[],o=r.getGeometry().getCoordinates(),a=O([o]),s=this.rBush_.getInExtent(a),u={};s.sort(ye);for(var h=0,l=s.length;h<l;++h){var g=s[h],d=g.segment,_=k(g.geometry),c=g.depth;if(c&&(_+="-"+c.join("-")),u[_]||(u[_]=new Array(2)),g.geometry.getType()!==I.CIRCLE||1!==g.index)if(!q(d[0],o)||u[_][0])if(!q(d[1],o)||u[_][1])k(d)in this.vertexSegments_&&!u[_][0]&&!u[_][1]&&this.insertVertexCondition_(e)&&i.push(g);else{if((g.geometry.getType()===I.LINE_STRING||g.geometry.getType()===I.MULTI_LINE_STRING)&&u[_][0]&&0===u[_][0].index)continue;this.dragSegments_.push([g,1]),u[_][1]=g}else this.dragSegments_.push([g,0]),u[_][0]=g;else{var p=Ee(t,g,n);q(p,o)&&!u[_][0]&&(this.dragSegments_.push([g,0]),u[_][0]=g)}}i.length&&this.willModifyFeatures_(e,[i]);for(var f=i.length-1;f>=0;--f)this.insertVertex_(i[f],o)}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var r=this.dragSegments_[t][0],n=r.geometry;if(n.getType()===I.CIRCLE){var i=n.getCenter(),o=r.featureSegments[0],a=r.featureSegments[1];o.segment[0]=i,o.segment[1]=i,a.segment[0]=i,a.segment[1]=i,this.rBush_.update(A(i),o);var s=n,u=ee();if(u){var h=e.map.getView().getProjection();s=s.clone().transform(u,h),s=K(s).transform(h,u)}this.rBush_.update(s.getExtent(),a)}else this.rBush_.update(O(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new me(ve,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)},t.prototype.handlePointerAtPixel_=function(e,t,r){var n,i,o=this,a=r||t.getCoordinateFromPixel(e),s=t.getView().getProjection();if(this.hitDetection_){var u="object"==typeof this.hitDetection_?function(e){return e===o.hitDetection_}:void 0;t.forEachFeatureAtPixel(e,(function(e,t,r){if((r=r||e.getGeometry()).getType()===I.POINT&&W(o.features_.getArray(),e)){i=r;var a=r.getFlatCoordinates().slice(0,2);n=[{feature:e,geometry:r,segment:[a,a]}]}return!0}),{layerFilter:u})}if(!n){var h=H(A(a,ce)),l=t.getView().getResolution()*this.pixelTolerance_,g=Y(X(h,l,ce));n=this.rBush_.getInExtent(g)}if(n&&n.length>0){var d=n.sort((function(e,t){return xe(a,e,s)-xe(a,t,s)}))[0],_=d.segment,c=Ee(a,d,s),p=t.getPixelFromCoordinate(c),f=j(e,p);if(i||f<=this.pixelTolerance_){var v={};if(v[k(_)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-a[0],this.delta_[1]=c[1]-a[1]),d.geometry.getType()===I.CIRCLE&&1===d.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[d.feature],[d.geometry]);else{var m=t.getPixelFromCoordinate(_[0]),y=t.getPixelFromCoordinate(_[1]),x=z(p,m),E=z(p,y);f=Math.sqrt(Math.min(x,E)),this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(c=x>E?_[1]:_[0]),this.createOrUpdateVertexFeature_(c,[d.feature],[d.geometry]);var C={};C[k(d.geometry)]=!0;for(var F=1,w=n.length;F<w;++F){var P=n[F].segment;if(!(q(_[0],P[0])&&q(_[1],P[1])||q(_[0],P[1])&&q(_[1],P[0])))break;var S=k(n[F].geometry);S in C||(C[S]=!0,v[k(P)]=!0)}}return void(this.vertexSegments_=v)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var r,n=e.segment,i=e.feature,o=e.geometry,a=e.depth,s=e.index;t.length<o.getStride();)t.push(0);switch(o.getType()){case I.MULTI_LINE_STRING:case I.POLYGON:(r=o.getCoordinates())[a[0]].splice(s+1,0,t);break;case I.MULTI_POLYGON:(r=o.getCoordinates())[a[1]][a[0]].splice(s+1,0,t);break;case I.LINE_STRING:(r=o.getCoordinates()).splice(s+1,0,t);break;default:return}this.setGeometryCoordinates_(o,r);var u=this.rBush_;u.remove(e),this.updateSegmentIndices_(o,s,a,1);var h={segment:[n[0],t],feature:i,geometry:o,depth:a,index:s};u.insert(O(h.segment),h),this.dragSegments_.push([h,1]);var l={segment:[t,n[1]],feature:i,geometry:o,depth:a,index:s+1};u.insert(O(l.segment),l),this.dragSegments_.push([l,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=D.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);var t=this.removeVertex_();return this.dispatchEvent(new me(ve,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1},t.prototype.removeVertex_=function(){var e,t,r,n,i,o,a,s,u,h,l,g=this.dragSegments_,d={},_=!1;for(i=g.length-1;i>=0;--i)h=(r=g[i])[0],l=k(h.feature),h.depth&&(l+="-"+h.depth.join("-")),l in d||(d[l]={}),0===r[1]?(d[l].right=h,d[l].index=h.index):1==r[1]&&(d[l].left=h,d[l].index=h.index+1);for(l in d){switch(u=d[l].right,a=d[l].left,(s=(o=d[l].index)-1)<0&&(s=0),e=t=(n=(h=void 0!==a?a:u).geometry).getCoordinates(),_=!1,n.getType()){case I.MULTI_LINE_STRING:t[h.depth[0]].length>2&&(t[h.depth[0]].splice(o,1),_=!0);break;case I.LINE_STRING:t.length>2&&(t.splice(o,1),_=!0);break;case I.MULTI_POLYGON:e=e[h.depth[1]];case I.POLYGON:(e=e[h.depth[0]]).length>4&&(o==e.length-1&&(o=0),e.splice(o,1),_=!0,0===o&&(e.pop(),e.push(e[0]),s=e.length-1))}if(_){this.setGeometryCoordinates_(n,t);var c=[];if(void 0!==a&&(this.rBush_.remove(a),c.push(a.segment[0])),void 0!==u&&(this.rBush_.remove(u),c.push(u.segment[1])),void 0!==a&&void 0!==u){var p={depth:h.depth,feature:h.feature,geometry:h.geometry,index:s,segment:c};this.rBush_.insert(O(p.segment),p)}this.updateSegmentIndices_(n,o,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),g.length=0}}return _},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,r,n){this.rBush_.forEachInExtent(e.getExtent(),(function(i){i.geometry===e&&(void 0===r||void 0===i.depth||J(i.depth,r))&&i.index>t&&(i.index+=n)}))},t}(Q),Fe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function we(e){return e.feature?e.feature:e.element?e.element:void 0}var Pe=[],Se=function(e){function t(t){var r=this,n=t||{},i=n;return i.handleDownEvent||(i.handleDownEvent=re),i.stopDown||(i.stopDown=ne),(r=e.call(this,i)||this).source_=n.source?n.source:null,r.vertex_=void 0===n.vertex||n.vertex,r.edge_=void 0===n.edge||n.edge,r.features_=n.features?n.features:null,r.featuresListenerKeys_=[],r.featureChangeListenerKeys_={},r.indexedFeaturesExtents_={},r.pendingFeatures_={},r.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,r.rBush_=new v,r.SEGMENT_WRITERS_={Point:r.writePointGeometry_.bind(r),LineString:r.writeLineStringGeometry_.bind(r),LinearRing:r.writeLineStringGeometry_.bind(r),Polygon:r.writePolygonGeometry_.bind(r),MultiPoint:r.writeMultiPointGeometry_.bind(r),MultiLineString:r.writeMultiLineStringGeometry_.bind(r),MultiPolygon:r.writeMultiPolygonGeometry_.bind(r),GeometryCollection:r.writeGeometryCollectionGeometry_.bind(r),Circle:r.writeCircleGeometry_.bind(r)},r}return Fe(t,e),t.prototype.addFeature=function(e,t){var r=void 0===t||t,n=k(e),i=e.getGeometry();if(i){var o=this.SEGMENT_WRITERS_[i.getType()];o&&(this.indexedFeaturesExtents_[n]=i.getExtent(ie()),o(e,i))}r&&(this.featureChangeListenerKeys_[n]=oe(e,N.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r.snapped&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=we(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=we(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=k(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=ae(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,n=k(e),i=this.indexedFeaturesExtents_[n];if(i){var o=this.rBush_,a=[];o.forEachInExtent(i,(function(t){e===t.feature&&a.push(t)}));for(var s=a.length-1;s>=0;--s)o.remove(a[s])}r&&(se(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},t.prototype.setMap=function(t){var r=this.getMap(),n=this.featuresListenerKeys_,i=this.getFeatures_();r&&(n.forEach(se),n.length=0,i.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?n.push(oe(this.features_,B.ADD,this.handleFeatureAdd_,this),oe(this.features_,B.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push(oe(this.source_,x.ADDFEATURE,this.handleFeatureAdd_,this),oe(this.source_,x.REMOVEFEATURE,this.handleFeatureRemove_,this)),i.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var n=r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i=r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),o=O([n,i]),a=this.rBush_.getInExtent(o);this.vertex_&&!this.edge_&&(a=a.filter((function(e){return e.feature.getGeometry().getType()!==I.CIRCLE})));var s=!1,u=null,h=null;if(0===a.length)return{snapped:s,vertex:u,vertexPixel:h};for(var l,g=r.getView().getProjection(),d=U(t),_=1/0,c=0;c<a.length;++c){var p=a[c];Pe[0]=U(p.segment[0]),Pe[1]=U(p.segment[1]);var f=te(d,Pe);f<_&&(l=p,_=f)}var v=l.segment;if(this.vertex_&&!this.edge_){var m=r.getPixelFromCoordinate(v[0]),y=r.getPixelFromCoordinate(v[1]),x=z(e,m),E=z(e,y);Math.sqrt(Math.min(x,E))<=this.pixelTolerance_&&(s=!0,u=x>E?v[1]:v[0],h=r.getPixelFromCoordinate(u))}else if(this.edge_){var C=l.feature.getGeometry().getType()===I.CIRCLE;if(C){var F=l.feature.getGeometry(),w=ee();w&&(F=F.clone().transform(w,g)),u=Z(ue(d,F))}else Pe[0]=U(v[0]),Pe[1]=U(v[1]),u=Z($(d,Pe));if(h=r.getPixelFromCoordinate(u),j(e,h)<=this.pixelTolerance_&&(s=!0,this.vertex_&&!C)){m=r.getPixelFromCoordinate(v[0]),y=r.getPixelFromCoordinate(v[1]),x=z(h,m),E=z(h,y);Math.sqrt(Math.min(x,E))<=this.pixelTolerance_&&(u=x>E?v[1]:v[0],h=r.getPixelFromCoordinate(u))}}return s&&(h=[Math.round(h[0]),Math.round(h[1])]),{snapped:s,vertex:u,vertexPixel:h}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,t){this.getMap().getView().getProjection();for(var r=K(t).getCoordinates()[0],n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:e,segment:o};this.rBush_.insert(O(o),a)}},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var i=this.SEGMENT_WRITERS_[r[n].getType()];i&&i(e,r[n])}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:e,segment:o};this.rBush_.insert(O(o),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var u=o.slice(a,a+2),h={feature:e,segment:u};this.rBush_.insert(O(u),h)}},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:e,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var u=o[a],h=0,l=u.length-1;h<l;++h){var g=u.slice(h,h+2),d={feature:e,segment:g};this.rBush_.insert(O(g),d)}},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),n={feature:e,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var u=o.slice(a,a+2),h={feature:e,segment:u};this.rBush_.insert(O(u),h)}},t}(Q);e("data-v-98c36a3a");const Te=h("div",{id:"map",class:"map__x"},null,-1),Ge=["value"];t();const Me={setup(e){const t=r(),v=n("Polygon"),x=i([{value:"Point",label:"点"},{value:"LineString",label:"线"},{value:"Polygon",label:"多边形"},{value:"Circle",label:"圆"},{value:"None",label:"无"}]),E=new p({source:new f}),C=new y({wrapX:!1}),T=new m({source:C,style:new F({fill:new w({color:"rgba(255, 255, 255, 0.2)"}),stroke:new P({color:"#ffcc33",width:2}),image:new S({radius:7,fill:new w({color:"#ffcc33"})})})}),G=new Ce({source:C,insertVertexCondition:()=>!1}),M=n(null);const b=n(null),L=n(null);function I(){null!==b.value&&M.value.removeInteraction(b.value),null!==L.value&&M.value.removeInteraction(L.value),"None"!==v.value&&(b.value=new ge({source:C,type:v.value}),M.value.addInteraction(b.value),L.value=new Se({source:C}))}return o((()=>{t.commit("setComponentPath","src/views/OpenLayers/Basic/pages/SnapGraph/SnapGraph.vue"),M.value=new he({target:"map",layers:[E,T],view:new le({projection:"EPSG:4326",center:[115.543045,45.16871],zoom:10})}),M.value.addInteraction(G),I()})),(e,t)=>(_(),a(l,null,[Te,s(h("select",{id:"type","onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),onChange:I},[(_(!0),a(l,null,g(d(x),(e=>(_(),a("option",{key:e.value,value:e.value},c(e.label),9,Ge)))),128))],544),[[u,v.value]])],64))},__scopeId:"data-v-98c36a3a"};export{Me as default};
