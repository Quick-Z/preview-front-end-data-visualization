import{X as t,aq as e,A as i,J as s,ch as o,aJ as n,ci as r,bk as a,a6 as h,cj as c,b6 as d,ck as _,cl as u,cm as l,cn as p,bD as f,co as g,E as y,cp as C,cq as m,bb as v,bF as k,cr as w,cs as P,z as T,w as D,v as L,u as F,o as O,ba as E}from"./ol.bbcea228.js";import{L as S,S as M,a as N,f as x}from"./Vector.d80cd09d.js";import{L as b}from"./LineString.9ae0adb3.js";import{b as I,a as G,M as R}from"./MultiPolygon.1b740cf8.js";var j,U=(j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),V=function(a){function h(t,e,i){var s=a.call(this)||this;if(void 0!==i&&void 0===e)s.setFlatCoordinates(i,t);else{var o=e||0;s.setCenterAndRadius(t,o,i)}return s}return U(h,a),h.prototype.clone=function(){var t=new h(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t},h.prototype.closestPointXY=function(t,e,i,s){var o=this.flatCoordinates,n=t-o[0],r=e-o[1],a=n*n+r*r;if(a<s){if(0===a)for(var h=0;h<this.stride;++h)i[h]=o[h];else{var c=this.getRadius()/Math.sqrt(a);i[0]=o[0]+c*n,i[1]=o[1]+c*r;for(h=2;h<this.stride;++h)i[h]=o[h]}return i.length=this.stride,a}return s},h.prototype.containsXY=function(t,e){var i=this.flatCoordinates,s=t-i[0],o=e-i[1];return s*s+o*o<=this.getRadiusSquared_()},h.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},h.prototype.computeExtent=function(e){var i=this.flatCoordinates,s=i[this.stride]-i[0];return t(i[0]-s,i[1]-s,i[0]+s,i[1]+s,e)},h.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},h.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},h.prototype.getType=function(){return e.CIRCLE},h.prototype.intersectsExtent=function(t){var e=this.getExtent();if(i(t,e)){var o=this.getCenter();return t[0]<=o[0]&&t[2]>=o[0]||(t[1]<=o[1]&&t[3]>=o[1]||s(t,this.intersectsCoordinate.bind(this)))}return!1},h.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],s=t.slice();s[e]=s[0]+i;for(var o=1;o<e;++o)s[e+o]=t[o];this.setFlatCoordinates(this.layout,s),this.changed()},h.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var s=this.flatCoordinates,n=o(s,0,t,this.stride);s[n++]=s[0]+e;for(var r=1,a=this.stride;r<a;++r)s[n++]=s[r];s.length=n,this.changed()},h.prototype.getCoordinates=function(){return null},h.prototype.setCoordinates=function(t,e){},h.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},h.prototype.rotate=function(t,e){var i=this.getCenter(),s=this.getStride();this.setCenter(n(i,0,i.length,s,t,e,i)),this.changed()},h.prototype.translate=function(t,e){var i=this.getCenter(),s=this.getStride();this.setCenter(r(i,0,i.length,s,t,e,i)),this.changed()},h}(a);V.prototype.transform;var q=V,A=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),H="Point",X="LineString",Y="Polygon",J="Circle",W="drawstart",z="drawend",B="drawabort",K=function(t){function e(e,i){var s=t.call(this,e)||this;return s.feature=i,s}return A(e,t),e}(h);function Q(t,e){return function(i,s,o){var n=_(i[0]),r=_(i[i.length-1]),a=Math.sqrt(u(n,r)),h=s||w(new q(n),t),c=e;if(!e&&0!==e){var d=r[0]-n[0],l=r[1]-n[1];c=Math.atan2(l,d)}return P(h,n,a,c),h}}function Z(){return function(t,e,i){var s=T([t[0],t[t.length-1]].map((function(t){return _(t)}))),o=[[D(s),L(s),F(s),O(s),D(s)]],n=e;return n?n.setCoordinates(o):n=new E(o),n}}var $=function(t){function i(i){var s=this,o=i;o.stopDown||(o.stopDown=c),(s=t.call(this,o)||this).on,s.once,s.un,s.shouldHandle_=!1,s.downPx_=null,s.downTimeout_,s.lastDragTime_,s.pointerType_,s.freehand_=!1,s.source_=i.source?i.source:null,s.features_=i.features?i.features:null,s.snapTolerance_=i.snapTolerance?i.snapTolerance:12,s.type_=i.type,s.mode_=function(t){switch(t){case e.POINT:case e.MULTI_POINT:return H;case e.LINE_STRING:case e.MULTI_LINE_STRING:return X;case e.POLYGON:case e.MULTI_POLYGON:return Y;case e.CIRCLE:return J;default:throw new Error("Invalid type: "+t)}}(s.type_),s.stopClick_=!!i.stopClick,s.minPoints_=i.minPoints?i.minPoints:s.mode_===Y?3:2,s.maxPoints_=s.mode_===J?2:i.maxPoints?i.maxPoints:1/0,s.finishCondition_=i.finishCondition?i.finishCondition:d;var n,r=i.geometryFunction;if(!r){var a,h=s.mode_;if(h===J)r=function(t,e,i){var s=e||new q([NaN,NaN]),o=_(t[0]),n=u(o,_(t[t.length-1]));return s.setCenterAndRadius(o,Math.sqrt(n)),s};else h===H?a=v:h===X?a=b:h===Y&&(a=E),r=function(t,e,i){return e?h===Y?t[0].length?e.setCoordinates([t[0].concat([t[0][0]])]):e.setCoordinates([]):e.setCoordinates(t):e=new a(t),e}}return s.geometryFunction_=r,s.dragVertexDelay_=void 0!==i.dragVertexDelay?i.dragVertexDelay:500,s.finishCoordinate_=null,s.sketchFeature_=null,s.sketchPoint_=null,s.sketchCoords_=null,s.sketchLine_=null,s.sketchLineCoords_=null,s.squaredClickTolerance_=i.clickTolerance?i.clickTolerance*i.clickTolerance:36,s.overlay_=new S({source:new M({useSpatialIndex:!1,wrapX:!!i.wrapX&&i.wrapX}),style:i.style?i.style:(n=x(),function(t,e){return n[t.getGeometry().getType()]}),updateWhileInteracting:!0}),s.geometryName_=i.geometryName,s.condition_=i.condition?i.condition:l,s.freehandCondition_,i.freehand?s.freehandCondition_=p:s.freehandCondition_=i.freehandCondition?i.freehandCondition:f,s.addChangeListener(g.ACTIVE,s.updateState_),s}return A(i,t),i.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},i.prototype.getOverlay=function(){return this.overlay_},i.prototype.handleEvent=function(e){e.originalEvent.type===y.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!==H&&this.freehandCondition_(e);var i=e.type===C.POINTERMOVE,s=!0;!this.freehand_&&this.lastDragTime_&&e.type===C.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,i=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===C.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),s=!1):this.freehand_&&e.type===C.POINTERDOWN?s=!1:i&&this.getPointerCount()<2?(s=e.type===C.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===C.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===C.DBLCLICK&&(s=!1),t.prototype.handleEvent.call(this,e)&&s},i.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new m(C.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},i.prototype.handleUpEvent=function(t){var e=!0;if(0===this.getPointerCount())if(this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t),this.shouldHandle_){var i=!this.finishCoordinate_;i&&this.startDrawing_(t.coordinate),!i&&this.freehand_?this.finishDrawing():this.freehand_||i&&this.mode_!==H||(this.atFinish_(t.pixel)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing();return!e&&this.stopClick_&&t.preventDefault(),e},i.prototype.handlePointerMove_=function(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,s=e[0]-i[0],o=e[1]-i[1],n=s*s+o*o;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(t.coordinate):this.createOrUpdateSketchPoint_(t.coordinate.slice())},i.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,s=[this.finishCoordinate_],o=this.mode_;if(o===H)e=!0;else if(o===J)e=2===this.sketchCoords_.length;else if(o===X)i=this.sketchCoords_.length>this.minPoints_;else if(o===Y){var n=this.sketchCoords_;i=n[0].length>this.minPoints_,s=[n[0][0],n[0][n[0].length-2]]}if(i)for(var r=this.getMap(),a=0,h=s.length;a<h;a++){var c=s[a],d=r.getPixelFromCoordinate(c),_=t[0]-d[0],u=t[1]-d[1],l=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(_*_+u*u)<=l){this.finishCoordinate_=c;break}}}return e},i.prototype.createOrUpdateSketchPoint_=function(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new N(new v(t)),this.updateSketchFeatures_())},i.prototype.createOrUpdateCustomSketchLine_=function(t){this.sketchLine_||(this.sketchLine_=new N);var e=t.getLinearRing(0),i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new b(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))},i.prototype.startDrawing_=function(t){var e=this.getMap().getView().getProjection();this.finishCoordinate_=t,this.mode_===H?this.sketchCoords_=t.slice():this.mode_===Y?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new N(new b(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new N,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new K(W,this.sketchFeature_))},i.prototype.modifyDrawing_=function(t){var i,s,o=this.getMap(),n=this.sketchFeature_.getGeometry(),r=o.getView().getProjection();(this.mode_===H?s=this.sketchCoords_:this.mode_===Y?(s=(i=this.sketchCoords_[0])[i.length-1],this.atFinish_(o.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):s=(i=this.sketchCoords_)[i.length-1],s[0]=t[0],s[1]=t[1],this.geometryFunction_(this.sketchCoords_,n,r),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(t);if(n.getType()===e.POLYGON&&this.mode_!==Y)this.createOrUpdateCustomSketchLine_(n);else if(this.sketchLineCoords_){this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_)}this.updateSketchFeatures_()},i.prototype.addToDrawing_=function(t){var e,i,s=this.sketchFeature_.getGeometry(),o=this.getMap().getView().getProjection(),n=this.mode_;n===X||n===J?(this.finishCoordinate_=t.slice(),(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),this.geometryFunction_(i,s,o)):n===Y&&((i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),e&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,s,o)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),e&&this.finishDrawing()},i.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,i=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection(),o=this.mode_;if(o===X||o===J){if((t=this.sketchCoords_).splice(-2,1),t.length>=2){this.finishCoordinate_=t[t.length-2].slice();var n=this.finishCoordinate_.slice();t[t.length-1]=n,this.createOrUpdateSketchPoint_(n)}this.geometryFunction_(t,i,s),i.getType()===e.POLYGON&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(i)}else if(o===Y){(t=this.sketchCoords_[0]).splice(-2,1);var r=this.sketchLine_.getGeometry();if(t.length>=2){n=t[t.length-2].slice();t[t.length-1]=n,this.createOrUpdateSketchPoint_(n)}r.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,i,s)}1===t.length&&this.abortDrawing(),this.updateSketchFeatures_()}},i.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var i=this.sketchCoords_,s=t.getGeometry(),o=this.getMap().getView().getProjection();this.mode_===X?(i.pop(),this.geometryFunction_(i,s,o)):this.mode_===Y&&(i[0].pop(),this.geometryFunction_(i,s,o),i=s.getCoordinates()),this.type_===e.MULTI_POINT?t.setGeometry(new I([i])):this.type_===e.MULTI_LINE_STRING?t.setGeometry(new G([i])):this.type_===e.MULTI_POLYGON&&t.setGeometry(new R([i])),this.dispatchEvent(new K(z,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},i.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),t},i.prototype.abortDrawing=function(){var t=this.abortDrawing_();t&&this.dispatchEvent(new K(B,t))},i.prototype.appendCoordinates=function(t){var e,i=this.mode_,s=!this.sketchFeature_;if(s&&this.startDrawing_(t[0]),i===X||i===J)e=this.sketchCoords_;else{if(i!==Y)return;e=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}s&&e.shift(),e.pop();for(var o=0;o<t.length;o++)this.addToDrawing_(t[o]);var n=t[t.length-1];this.addToDrawing_(n),this.modifyDrawing_(n)},i.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new N(new v(i)),this.updateSketchFeatures_(),this.dispatchEvent(new K(W,this.sketchFeature_))},i.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},i.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing(),this.overlay_.setMap(e?t:null)},i}(k);export{$ as D,Z as a,Q as c};
